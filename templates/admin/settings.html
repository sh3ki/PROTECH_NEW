{% extends 'components/base_component.html' %}

{% block title %}PROTECH - System Settings{% endblock %}
{% block page_title %}System Settings{% endblock %}

{% block sidebar %}
    {% include 'components/sidebar/admin_sidebar.html' with active='settings' %}
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Attendance Mode Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Attendance Device Mode</h2>
        </div>
        
        <p class="text-accent dark:text-gray-400 mb-6">
            Configure how attendance devices display time in and time out options. Choose between separate screens or a hybrid view with dual cameras.
        </p>

        <form method="POST" action="{% url 'save_attendance_mode' %}" class="space-y-6" x-data="{ attendanceMode: '{{ current_mode|default:"SEPARATE" }}' }">
            {% csrf_token %}
            
            <!-- Mode Selection -->
            <div class="space-y-4">
                <label class="flex items-center justify-between p-5 border-2 rounded-xl cursor-pointer transition-all hover:border-blue-400 dark:hover:border-blue-600 bg-gray-50 dark:bg-gray-900"
                       :class="attendanceMode === 'SEPARATE' ? 'border-blue-500 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'border-gray-300 dark:border-gray-700'">
                    <div class="flex items-center gap-4">
                        <input type="radio" name="attendance_mode" value="SEPARATE" 
                               class="w-5 h-5 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-600"
                               {% if current_mode == 'SEPARATE' or not current_mode %}checked{% endif %}
                               x-model="attendanceMode">
                        <div>
                            <div class="font-semibold text-primary dark:text-tertiary text-lg">Separate Screens</div>
                            <div class="text-sm text-accent dark:text-gray-400">Time In and Time Out on different pages (Current default)</div>
                        </div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                         x-show="attendanceMode === 'SEPARATE'">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </label>

                <label class="flex items-center justify-between p-5 border-2 rounded-xl cursor-pointer transition-all hover:border-blue-400 dark:hover:border-blue-600 bg-gray-50 dark:bg-gray-900"
                       :class="attendanceMode === 'HYBRID' ? 'border-blue-500 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'border-gray-300 dark:border-gray-700'">
                    <div class="flex items-center gap-4">
                        <input type="radio" name="attendance_mode" value="HYBRID" 
                               class="w-5 h-5 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-600"
                               {% if current_mode == 'HYBRID' %}checked{% endif %}
                               x-model="attendanceMode">
                        <div>
                            <div class="font-semibold text-primary dark:text-tertiary text-lg">Hybrid Mode (Dual Camera)</div>
                            <div class="text-sm text-accent dark:text-gray-400">Time In and Time Out on same page with 2 camera feeds</div>
                        </div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                         x-show="attendanceMode === 'HYBRID'">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </label>
            </div>

            <!-- Camera Count Selection (Only shown when Separate Screens is selected) -->
            <div x-show="attendanceMode === 'SEPARATE'" x-transition class="space-y-3">
                <label class="block">
                    <span class="text-sm font-semibold text-primary dark:text-tertiary mb-2 block">Number of Cameras</span>
                    <select name="camera_count" 
                            class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-900 dark:text-white transition-all">
                        <option value="1" {% if camera_count == 1 %}selected{% endif %}>1 Camera (1x1)</option>
                        <option value="2" {% if camera_count == 2 %}selected{% endif %}>2 Cameras (1x2 side by side)</option>
                        <option value="3" {% if camera_count == 3 %}selected{% endif %}>3 Cameras (2x2 grid, bottom right empty)</option>
                        <option value="4" {% if camera_count == 4 %}selected{% endif %}>4 Cameras (2x2 full grid)</option>
                    </select>
                </label>
                <p class="text-xs text-gray-600 dark:text-gray-400">
                    Select how many cameras to display on Time In and Time Out pages. Grid layout adjusts automatically.
                </p>
            </div>

            <!-- Info Card -->
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6">
                <div class="flex gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="text-sm text-blue-800 dark:text-blue-300">
                        <p class="font-semibold mb-2">Important Notes:</p>
                        <ul class="list-disc list-inside space-y-1 text-blue-700 dark:text-blue-400">
                            <li>Separate mode shows individual buttons for Time In and Time Out on the device selection page</li>
                            <li>Hybrid mode shows a single button that opens a page with two camera feeds for simultaneous time in/out</li>
                            <li>Changes will take effect immediately on all attendance devices</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="submit" 
                        class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
                    </svg>
                    Save Settings
                </button>
            </div>
        </form>

        {% if messages %}
            <div class="mt-4">
                {% for message in messages %}
                    <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300{% else %}bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Holiday Mode Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Holiday Mode</h2>
        </div>

        <p class="text-accent dark:text-gray-400 mb-6">
            Enable holiday mode to temporarily disable face recognition attendance on all devices. When enabled, Time In, Time Out, and Hybrid Attendance pages will display a holiday notice instead of the camera feed.
        </p>

        <form method="POST" action="{% url 'save_holiday_mode' %}" class="space-y-6">
            {% csrf_token %}
            <div class="flex items-center justify-between p-5 border-2 rounded-xl bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700">
                <div>
                    <div class="font-semibold text-primary dark:text-tertiary text-lg">Face Recognition Attendance</div>
                    <div class="text-sm text-accent dark:text-gray-400">Toggle face recognition on/off for holidays or special events</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="holiday_mode" class="sr-only peer" {% if holiday_mode %}checked{% endif %}>
                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-red-600"></div>
                    <span class="ml-3 text-sm text-gray-700 dark:text-gray-300">{{ holiday_mode|yesno:"Holiday (OFF),Active (ON)" }}</span>
                </label>
            </div>

            <!-- Info Card -->
            <div class="{% if holiday_mode %}bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800{% else %}bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800{% endif %} border rounded-xl p-6">
                <div class="flex gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 {% if holiday_mode %}text-red-600 dark:text-red-400{% else %}text-blue-600 dark:text-blue-400{% endif %} flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="text-sm {% if holiday_mode %}text-red-800 dark:text-red-300{% else %}text-blue-800 dark:text-blue-300{% endif %}">
                        <p class="font-semibold mb-2">Current Status:</p>
                        <ul class="list-disc list-inside space-y-1 {% if holiday_mode %}text-red-700 dark:text-red-400{% else %}text-blue-700 dark:text-blue-400{% endif %}">
                            {% if holiday_mode %}
                                <li><strong>Holiday Mode is ON:</strong> Face recognition is disabled on all devices</li>
                                <li>Time In, Time Out, and Hybrid pages will show "Face Recognition Attendance is OFF because of Holiday"</li>
                                <li>No attendance will be recorded until Holiday Mode is turned off</li>
                            {% else %}
                                <li><strong>Holiday Mode is OFF:</strong> Face recognition is active on all devices</li>
                                <li>Students can mark attendance normally through Time In, Time Out, and Hybrid pages</li>
                                <li>All attendance features are functioning as usual</li>
                            {% endif %}
                            <li>Changes take effect immediately on all attendance devices</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-end gap-3 pt-2">
                <button type="submit" class="bg-gradient-to-r {% if holiday_mode %}from-green-600 to-green-500 hover:from-green-700 hover:to-green-600{% else %}from-red-600 to-red-500 hover:from-red-700 hover:to-red-600{% endif %} text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293z" />
                    </svg>
                    {% if holiday_mode %}Turn ON Attendance{% else %}Turn ON Holiday Mode{% endif %}
                </button>
            </div>
        </form>

        {% if messages %}
            <div class="mt-4">
                {% for message in messages %}
                    <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300{% else %}bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Gate Mode Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h10M4 18h6" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Gate Mode</h2>
        </div>

        <p class="text-accent dark:text-gray-400 mb-6">
            Choose how the gate/attendance logic behaves. Closed Gate follows class timing and grace rules. Open Gate allows free entry/exit and marks every valid log as On Time with safety checks.
        </p>

        <form method="POST" action="{% url 'save_gate_mode' %}" class="space-y-4" x-data="{ gateMode: '{{ gate_mode|default:"CLOSED" }}' }">
            {% csrf_token %}

            <label class="flex items-start justify-between p-5 border-2 rounded-xl cursor-pointer transition-all hover:border-blue-400 dark:hover:border-blue-600 bg-gray-50 dark:bg-gray-900"
                   :class="gateMode === 'CLOSED' ? 'border-blue-500 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'border-gray-300 dark:border-gray-700'">
                <div class="flex gap-4">
                    <input type="radio" name="gate_mode" value="CLOSED" class="w-5 h-5 mt-1 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-600" x-model="gateMode">
                    <div>
                        <div class="font-semibold text-primary dark:text-tertiary text-lg">Closed Gate (Default)</div>
                        <ul class="text-sm text-accent dark:text-gray-400 list-disc list-inside space-y-1">
                            <li>Uses class timing + grace period to set On Time/Late</li>
                            <li>Behaves exactly like current rules</li>
                        </ul>
                    </div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" x-show="gateMode === 'CLOSED'">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </label>

            <label class="flex items-start justify-between p-5 border-2 rounded-xl cursor-pointer transition-all hover:border-blue-400 dark:hover:border-blue-600 bg-gray-50 dark:bg-gray-900"
                   :class="gateMode === 'OPEN' ? 'border-blue-500 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'border-gray-300 dark:border-gray-700'">
                <div class="flex gap-4">
                    <input type="radio" name="gate_mode" value="OPEN" class="w-5 h-5 mt-1 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-600" x-model="gateMode">
                    <div>
                        <div class="font-semibold text-primary dark:text-tertiary text-lg">Open Gate</div>
                        <ul class="text-sm text-accent dark:text-gray-400 list-disc list-inside space-y-1">
                            <li>All valid Time In/Out logs are labeled On Time</li>
                            <li>Time In only when student is outside; ignore duplicate consecutive Time In</li>
                            <li>Time Out only when student is inside</li>
                            <li>Allows re-entry (Time In ‚Üí Time Out ‚Üí Time In)</li>
                        </ul>
                    </div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" x-show="gateMode === 'OPEN'">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </label>

            <div class="flex items-center justify-end gap-3 pt-2">
                <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293z" />
                    </svg>
                    Save Gate Mode
                </button>
            </div>
        </form>

        {% if messages %}
            <div class="mt-4">
                {% for message in messages %}
                    <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300{% else %}bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Spoof-Proof Liveness Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Spoof-Proof Liveness</h2>
        </div>

        <p class="text-accent dark:text-gray-400 mb-6">
            Require facial micro-movements (blink and landmark motion) before matching. Turn off only for testing or low-trust cameras.
        </p>

        <form method="POST" action="{% url 'save_spoof_proofing' %}" class="space-y-6">
            {% csrf_token %}
            <div class="flex items-center justify-between p-5 border-2 rounded-xl bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700">
                <div>
                    <div class="font-semibold text-primary dark:text-tertiary text-lg">Spoof-Proof Liveness</div>
                    <div class="text-sm text-accent dark:text-gray-400">Blocks photos/videos by requiring eye blinks or micro-movement</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="spoof_proof_enabled" class="sr-only peer" {% if spoof_proof_enabled %}checked{% endif %}>
                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    <span class="ml-3 text-sm text-gray-700 dark:text-gray-300">{{ spoof_proof_enabled|yesno:"Enabled,Disabled" }}</span>
                </label>
            </div>

            <div class="flex items-center justify-end gap-3 pt-2">
                <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293z" />
                    </svg>
                    Save Spoof-Proofing
                </button>
            </div>
        </form>

        {% if messages %}
            <div class="mt-4">
                {% for message in messages %}
                    <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300{% else %}bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Prototype Gate System Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Prototype Gate System</h2>
        </div>

        <p class="text-accent dark:text-gray-400 mb-6">
            Enable or disable the prototype gate system and gate queue check functionality. When enabled, the system checks gate queue status during attendance operations.
        </p>

        <form method="POST" action="{% url 'save_prototype_gate_system' %}" class="space-y-6">
            {% csrf_token %}
            <div class="flex items-center justify-between p-5 border-2 rounded-xl bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700">
                <div>
                    <div class="font-semibold text-primary dark:text-tertiary text-lg">Gate Queue Check</div>
                    <div class="text-sm text-accent dark:text-gray-400">Checks gate queue and enforces queue-based attendance logic</div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="prototype_gate_system_enabled" class="sr-only peer" {% if prototype_gate_system_enabled %}checked{% endif %}>
                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    <span class="ml-3 text-sm text-gray-700 dark:text-gray-300">{{ prototype_gate_system_enabled|yesno:"Enabled,Disabled" }}</span>
                </label>
            </div>

            <!-- Info Card -->
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6">
                <div class="flex gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="text-sm text-blue-800 dark:text-blue-300">
                        <p class="font-semibold mb-2">System Status:</p>
                        <ul class="list-disc list-inside space-y-1 text-blue-700 dark:text-blue-400">
                            <li><strong>When Enabled (ON):</strong> Gate queue checks are active and will enforce queue-based attendance rules</li>
                            <li><strong>When Disabled (OFF):</strong> Gate queue checks are bypassed, attendance operates without queue validation</li>
                            <li>Default: <strong>Enabled (ON)</strong></li>
                            <li>Changes take effect immediately on all gate operations</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="flex items-center justify-end gap-3 pt-2">
                <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293z" />
                    </svg>
                    Save Prototype Gate System
                </button>
            </div>
        </form>

        {% if messages %}
            <div class="mt-4">
                {% for message in messages %}
                    <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300{% else %}bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Class Timing Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Class Timing & Grace Period</h2>
        </div>
        
        <p class="text-accent dark:text-gray-400 mb-6">
            Configure class start times and grace period. The system automatically calculates late status based on these settings.
        </p>

        <form method="POST" action="{% url 'save_class_times' %}" class="space-y-6" x-data="{ hasSecondClass: {{ has_second_class|yesno:'true,false' }}, gateMode: '{{ gate_mode|default:"CLOSED" }}' }">
            {% csrf_token %}
            <div class="flex items-center justify-between bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-xl px-4 py-3 text-amber-800 dark:text-amber-200" x-show="gateMode === 'OPEN'">
                <div class="text-sm font-medium">Gate Mode is OPEN ‚Äî class times and grace period are locked and display-only.</div>
            </div>
            
            <!-- First Class Start Time -->
            <div class="space-y-2">
                <label for="first_class_start_time" class="block text-sm font-semibold text-primary dark:text-tertiary flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    First Class Start Time (Asia/Manila)
                    <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                    <input type="time" 
                           id="first_class_start_time" 
                           name="first_class_start_time" 
                           value="{{ first_class_time|default:'07:00' }}"
                           class="w-full md:w-1/2 px-4 py-3 bg-gray-50 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-600 dark:focus:border-blue-600 text-primary dark:text-tertiary font-medium transition-all"
                           :class="gateMode === 'OPEN' ? 'opacity-60 cursor-not-allowed' : ''"
                           :disabled="gateMode === 'OPEN'"
                           required>
                </div>
                <p class="text-xs text-accent dark:text-gray-500">
                    The time when your first class session begins each day
                </p>
            </div>

            <!-- Second Class Start Time (Optional) -->
            <div class="space-y-2">
                <div class="flex items-center justify-between">
                    <label for="second_class_start_time" class="block text-sm font-semibold text-primary dark:text-tertiary flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        Second Class Start Time (Optional)
                    </label>
                    <label class="relative inline-flex items-center cursor-pointer" :class="gateMode === 'OPEN' ? 'opacity-60 cursor-not-allowed' : ''">
                        <input type="checkbox" class="sr-only peer" x-model="hasSecondClass" :disabled="gateMode === 'OPEN'">
                        <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Enable Second Class</span>
                    </label>
                </div>
                <div class="relative" x-show="hasSecondClass">
                    <input type="time" 
                           id="second_class_start_time" 
                           name="second_class_start_time" 
                           value="{{ second_class_time|default:'' }}"
                           :disabled="!hasSecondClass || gateMode === 'OPEN'"
                           :class="gateMode === 'OPEN' ? 'opacity-60 cursor-not-allowed' : ''"
                           class="w-full md:w-1/2 px-4 py-3 bg-gray-50 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-600 dark:focus:border-blue-600 text-primary dark:text-tertiary font-medium transition-all">
                </div>
                <p class="text-xs text-amber-600 dark:text-amber-400" x-show="hasSecondClass">
                    ‚ö†Ô∏è Second class must be at least <strong>4 hours after</strong> the first class
                </p>
            </div>

            <!-- Grace Period -->
            <div class="space-y-2">
                <label for="grace_period_minutes" class="block text-sm font-semibold text-primary dark:text-tertiary flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Late Time Grace Period (Minutes)
                    <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                    <input type="number" 
                           id="grace_period_minutes" 
                           name="grace_period_minutes" 
                           value="{{ grace_period|default:'5' }}"
                           min="0"
                           max="60"
                           class="w-full md:w-1/3 px-4 py-3 bg-gray-50 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-600 dark:focus:border-blue-600 text-primary dark:text-tertiary font-medium transition-all"
                           :class="gateMode === 'OPEN' ? 'opacity-60 cursor-not-allowed' : ''"
                           :disabled="gateMode === 'OPEN'"
                           required>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <span class="text-accent dark:text-gray-500 text-sm">minutes</span>
                    </div>
                </div>
                <p class="text-xs text-accent dark:text-gray-500">
                    Students are marked late starting <strong>1 minute after</strong> the grace period ends
                </p>
            </div>

            <!-- Attendance Windows Info Card -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-2 border-blue-200 dark:border-blue-800 rounded-xl p-6">
                <div class="flex gap-3 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="flex-1">
                        <h3 class="font-semibold text-blue-900 dark:text-blue-300 text-lg mb-3">How Attendance Status is Calculated</h3>
                        
                        <div class="space-y-4 text-sm text-blue-800 dark:text-blue-300">
                            <!-- Single Class Example -->
                            <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-4">
                                <p class="font-semibold mb-2">üìò Example: Single Class Session</p>
                                <ul class="space-y-1 ml-4">
                                    <li>‚Ä¢ First Class Start: <strong>7:00 AM</strong></li>
                                    <li>‚Ä¢ Grace Period: <strong>5 minutes</strong></li>
                                </ul>
                                <div class="mt-3 space-y-1 text-xs">
                                    <p class="text-green-700 dark:text-green-400">‚úÖ <strong>Present:</strong> 5:00 AM ‚Äì 7:05 AM</p>
                                    <p class="text-orange-700 dark:text-orange-400">‚è∞ <strong>Late:</strong> 7:06 AM onward</p>
                                </div>
                            </div>

                            <!-- Two Classes Example -->
                            <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-4">
                                <p class="font-semibold mb-2">üìó Example: Two Class Sessions</p>
                                <ul class="space-y-1 ml-4">
                                    <li>‚Ä¢ First Class Start: <strong>7:00 AM</strong></li>
                                    <li>‚Ä¢ Second Class Start: <strong>12:00 PM</strong> (min 4 hours apart)</li>
                                    <li>‚Ä¢ Grace Period: <strong>5 minutes</strong> (shared)</li>
                                </ul>
                                <div class="mt-3 space-y-2 text-xs">
                                    <div>
                                        <p class="font-semibold mb-1">First Session:</p>
                                        <p class="text-green-700 dark:text-green-400 ml-2">‚úÖ Present: 5:00 AM ‚Äì 7:05 AM</p>
                                        <p class="text-orange-700 dark:text-orange-400 ml-2">‚è∞ Late: 7:06 AM ‚Äì 9:59 AM</p>
                                    </div>
                                    <div>
                                        <p class="font-semibold mb-1">Second Session:</p>
                                        <p class="text-green-700 dark:text-green-400 ml-2">‚úÖ Present: 10:00 AM ‚Äì 12:05 PM</p>
                                        <p class="text-orange-700 dark:text-orange-400 ml-2">‚è∞ Late: 12:06 PM onward</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Key Rules -->
                            <div class="mt-3 pt-3 border-t border-blue-300 dark:border-blue-700">
                                <p class="font-semibold mb-2">üìå Key Rules:</p>
                                <ul class="list-disc list-inside space-y-1 text-blue-700 dark:text-blue-400">
                                    <li>Present window starts <strong>2 hours before</strong> class start time</li>
                                    <li>Late starts <strong>1 minute after</strong> grace period ends</li>
                                    <li>Second class must be <strong>at least 4 hours</strong> after first</li>
                                    <li>Grace period applies to <strong>all class sessions</strong></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="submit" 
                        class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
                    </svg>
                    Save Class Timing Settings
                </button>
            </div>
        </form>
    </div>

    <!-- Notification Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Attendance Notifications</h2>
        </div>
        
        <p class="text-accent dark:text-gray-400 mb-6">
            Control whether parents and guardians receive email and SMS notifications when students check in or out.
        </p>

        <form method="POST" action="{% url 'save_notification_settings' %}" class="space-y-6" x-data="{ emailEnabled: {{ email_enabled|yesno:'true,false' }}, smsEnabled: {{ sms_enabled|yesno:'true,false' }} }">
            {% csrf_token %}
            
            <!-- Email Notifications Toggle -->
            <div class="flex items-center justify-between p-5 bg-gray-50 dark:bg-gray-900 rounded-xl border-2 border-gray-300 dark:border-gray-700">
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0 h-12 w-12 rounded-full flex items-center justify-center"
                         :class="emailEnabled ? 'bg-blue-100 dark:bg-blue-900' : 'bg-gray-100 dark:bg-gray-800'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                             :class="emailEnabled ? 'text-blue-600 dark:text-blue-400' : 'text-gray-400 dark:text-gray-600'"
                             fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold text-primary dark:text-tertiary text-lg">Email Notifications</div>
                        <div class="text-sm text-accent dark:text-gray-400">
                            Send email alerts to parents when students check in/out
                        </div>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="email_notifications_enabled" class="sr-only peer" 
                           {% if email_enabled %}checked{% endif %}
                           x-model="emailEnabled">
                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                </label>
            </div>

            <!-- SMS Notifications Toggle -->
            <div class="flex items-center justify-between p-5 bg-gray-50 dark:bg-gray-900 rounded-xl border-2 border-gray-300 dark:border-gray-700">
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0 h-12 w-12 rounded-full flex items-center justify-center"
                         :class="smsEnabled ? 'bg-green-100 dark:bg-green-900' : 'bg-gray-100 dark:bg-gray-800'">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                             :class="smsEnabled ? 'text-green-600 dark:text-green-400' : 'text-gray-400 dark:text-gray-600'"
                             fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                        </svg>
                    </div>
                    <div>
                        <div class="font-semibold text-primary dark:text-tertiary text-lg">SMS Notifications</div>
                        <div class="text-sm text-accent dark:text-gray-400">
                            Send SMS alerts to parents when students check in/out
                        </div>
                    </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="sms_notifications_enabled" class="sr-only peer" 
                           {% if sms_enabled %}checked{% endif %}
                           x-model="smsEnabled">
                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                </label>
            </div>

            <!-- Info Card -->
            <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6">
                <div class="flex gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600 dark:text-amber-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="text-sm text-amber-800 dark:text-amber-300">
                        <p class="font-semibold mb-2">Important Notes:</p>
                        <ul class="list-disc list-inside space-y-1 text-amber-700 dark:text-amber-400">
                            <li>Disabling notifications will stop sending alerts to ALL parents and guardians</li>
                            <li>Email notifications require valid email addresses in parent/guardian profiles</li>
                            <li>SMS notifications require valid Philippine mobile numbers (+63 format)</li>
                            <li>Changes take effect immediately for all future attendance records</li>
                            <li>Notifications are sent in real-time when students check in or out</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="submit" 
                        class="bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
                    </svg>
                    Save Notification Settings
                </button>
            </div>
        </form>
    </div>

    <!-- Recognition Display Mode Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Recognition Display Mode</h2>
        </div>
        
        <p class="text-accent dark:text-gray-400 mb-6">
            Control how recognized students are displayed on the Time In, Time Out, and Hybrid attendance screens.
        </p>

        <form method="POST" action="{% url 'save_display_mode' %}" class="space-y-6">
            {% csrf_token %}
            
            <!-- Display Mode Options -->
            <div class="space-y-4">
                <!-- Scrollable List Option -->
                <label class="flex items-start p-5 bg-gray-50 dark:bg-gray-900 rounded-xl border-2 cursor-pointer transition-all"
                       :class="'{{ display_mode }}' === 'SCROLLABLE' ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/20' : 'border-gray-300 dark:border-gray-700 hover:border-purple-300'">
                    <input type="radio" name="recognition_display_mode" value="SCROLLABLE" 
                           class="mt-1 h-5 w-5 text-purple-600 focus:ring-purple-500"
                           {% if display_mode == 'SCROLLABLE' %}checked{% endif %}>
                    <div class="ml-4">
                        <div class="font-semibold text-primary dark:text-tertiary text-lg flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-600 dark:text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                            Scrollable List
                        </div>
                        <div class="text-sm text-accent dark:text-gray-400 mt-1">
                            Show all recognized students in a scrollable list. Best for monitoring multiple students throughout the day.
                        </div>
                        <div class="mt-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-purple-200 dark:border-purple-800">
                            <p class="text-xs font-semibold text-purple-700 dark:text-purple-400 mb-2">‚úì Advantages:</p>
                            <ul class="text-xs text-purple-600 dark:text-purple-300 space-y-1">
                                <li>‚Ä¢ View complete attendance history for the day</li>
                                <li>‚Ä¢ Track timing patterns (who's late, who's on time)</li>
                                <li>‚Ä¢ Scroll to review past recognitions</li>
                            </ul>
                        </div>
                    </div>
                </label>

                <!-- Latest Only Option -->
                <label class="flex items-start p-5 bg-gray-50 dark:bg-gray-900 rounded-xl border-2 cursor-pointer transition-all"
                       :class="'{{ display_mode }}' === 'LATEST' ? 'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20' : 'border-gray-300 dark:border-gray-700 hover:border-indigo-300'">
                    <input type="radio" name="recognition_display_mode" value="LATEST" 
                           class="mt-1 h-5 w-5 text-indigo-600 focus:ring-indigo-500"
                           {% if display_mode == 'LATEST' %}checked{% endif %}>
                    <div class="ml-4">
                        <div class="font-semibold text-primary dark:text-tertiary text-lg flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-600 dark:text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            Latest Only
                        </div>
                        <div class="text-sm text-accent dark:text-gray-400 mt-1">
                            Show only the most recently recognized student. Clean, minimal interface focusing on current recognition.
                        </div>
                        <div class="mt-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-indigo-200 dark:border-indigo-800">
                            <p class="text-xs font-semibold text-indigo-700 dark:text-indigo-400 mb-2">‚úì Advantages:</p>
                            <ul class="text-xs text-indigo-600 dark:text-indigo-300 space-y-1">
                                <li>‚Ä¢ Cleaner, less cluttered display</li>
                                <li>‚Ä¢ Focus on the current student only</li>
                                <li>‚Ä¢ Faster screen refresh and performance</li>
                                <li>‚Ä¢ Better for large screens or public displays</li>
                            </ul>
                        </div>
                    </div>
                </label>
            </div>

            <!-- Info Card -->
            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6">
                <div class="flex gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="text-sm text-blue-800 dark:text-blue-300">
                        <p class="font-semibold mb-2">This setting applies to:</p>
                        <ul class="list-disc list-inside space-y-1 text-blue-700 dark:text-blue-400">
                            <li><strong>Time In Screen</strong> - "Recognized Students" sidebar</li>
                            <li><strong>Time Out Screen</strong> - "Recognized Students" sidebar</li>
                            <li><strong>Hybrid Mode</strong> - Both Time In and Time Out sidebars</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button type="submit" 
                        class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z" />
                    </svg>
                    Save Display Mode
                </button>
            </div>
        </form>
    </div>

    <!-- Backup & Recovery Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-6" x-data="backupManager()">
        <div class="flex items-center gap-3 mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary dark:text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
            </svg>
            <h2 class="text-2xl font-bold text-primary dark:text-tertiary">Backup & Recovery</h2>
        </div>
        
        <p class="text-accent dark:text-gray-400 mb-6">
            Manage database backups for disaster recovery. Download backups manually or rely on automatic daily backups at 00:00 Manila Time.
        </p>

        <!-- Backup Actions -->
        <div class="space-y-4 mb-6">
            <!-- Manual Backup Button -->
            <div class="flex items-center justify-between p-5 bg-gray-50 dark:bg-gray-900 rounded-xl border-2 border-gray-300 dark:border-gray-700">
                <div>
                    <h3 class="font-semibold text-primary dark:text-tertiary text-lg mb-1">Manual Backup</h3>
                    <p class="text-sm text-accent dark:text-gray-400">Create and download a database backup now</p>
                </div>
                <a href="{% url 'download_database_backup' %}" 
                   class="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-semibold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2"
                   @click="downloading = true">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <span x-show="!downloading">Download Backup</span>
                    <span x-show="downloading">Downloading...</span>
                </a>
            </div>

            <!-- Automatic Backup Info -->
            <div class="flex items-start gap-3 p-5 bg-blue-50 dark:bg-blue-900/20 rounded-xl border-2 border-blue-200 dark:border-blue-800">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div class="flex-1">
                    <h3 class="font-semibold text-blue-900 dark:text-blue-300 text-lg mb-1">Automatic Backups</h3>
                    <p class="text-sm text-blue-700 dark:text-blue-400">
                        Daily backups run automatically at <strong>00:00 (midnight) Asia/Manila Time</strong>
                    </p>
                    <p class="text-xs text-blue-600 dark:text-blue-500 mt-2">
                        Backups are stored in the "database backup" folder on the server. The system keeps the last 30 backups automatically.
                    </p>
                </div>
            </div>
        </div>

        <!-- Recent Backups List -->
        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-primary dark:text-tertiary">Recent Backups</h3>
                <button @click="loadBackups()" 
                        class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                    </svg>
                    Refresh
                </button>
            </div>

            <div x-show="loading" class="text-center py-8">
                <svg class="animate-spin h-8 w-8 mx-auto text-blue-600 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>

            <div x-show="!loading && backups.length === 0" class="text-center py-8 text-accent dark:text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                </svg>
                <p>No backups found</p>
            </div>

            <div x-show="!loading && backups.length > 0" class="space-y-2">
                <template x-for="backup in backups" :key="backup.filename">
                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <!-- Icon based on backup type -->
                            <div class="flex-shrink-0">
                                <svg x-show="backup.backup_type === 'Manual'" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <svg x-show="backup.backup_type === 'Automatic'" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <p class="text-sm font-medium text-primary dark:text-tertiary" x-text="backup.filename"></p>
                                    <span class="px-2 py-0.5 text-xs font-semibold rounded-full" 
                                          :class="backup.backup_type === 'Manual' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300'"
                                          x-text="backup.backup_type"></span>
                                </div>
                                <p class="text-xs text-accent dark:text-gray-500 mt-1">
                                    <span x-text="backup.created_at"></span> ‚Ä¢ 
                                    <span x-text="backup.size_mb"></span> MB ‚Ä¢ 
                                    <span x-text="backup.initiated_by"></span>
                                </p>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <p class="text-xs text-accent dark:text-gray-500 mt-4 text-center">
                Showing last 5 backups. Total: <span x-text="totalCount"></span> successful backup(s).
            </p>
        </div>
    </div>
</div>

<script>
function backupManager() {
    return {
        backups: [],
        loading: false,
        downloading: false,
        totalCount: 0,
        
        init() {
            this.loadBackups();
        },
        
        async loadBackups() {
            this.loading = true;
            try {
                const response = await fetch('{% url "get_backup_status" %}');
                const data = await response.json();
                
                if (data.status === 'success') {
                    this.backups = data.backups;
                    this.totalCount = data.total_count;
                }
            } catch (error) {
                console.error('Error loading backups:', error);
            } finally {
                this.loading = false;
            }
        }
    }
}
</script>

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}
